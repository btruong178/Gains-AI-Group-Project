{% extends 'base.html' %}
{% load static %}
{% block content %}
  <title>Community Forum</title>
    <!-- Header 2 -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
      <a class="navbar-brand" href="{% url 'community' %}">GaiNS Community</a>
    </nav>
  </header>
  <style>
    .dark-mode {
      /* dark mode */
      background-color: #000000;
      color: #fff;
    }
    /* General Styles */
    body {
      font-family: Arial, sans-serif;
      background-color: #f5f5f5;
    }

    .container-fluid {
      padding: 30px;
    }

    /* Header Styles */
    .navbar {
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }

    .navbar-brand {
      font-weight: bold;
    }

    /* Question Card Styles */
    .question-card {
      background-color: #fff;
      border-radius: 5px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      padding: 20px;
      margin-bottom: 20px;
    }

    .question-card h4 {
      font-size: 18px;
      font-weight: bold;
      margin-bottom: 10px;
    }

    .question-card .meta {
      color: #888;
      font-size: 14px;
      margin-bottom: 15px;
    }

    .question-card .username {
      font-weight: bold;
    }

    .question-card .btn {
      font-size: 14px;
      padding: 5px 10px;
    }

    /* Top Contributors Styles */
    .top-contributors {
      background-color: #fff;
      border-radius: 5px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      padding: 20px;
      margin-bottom: 20px;
    }

    .top-contributors h4 {
      font-size: 18px;
      font-weight: bold;
      margin-bottom: 15px;
    }

    .top-contributors .contributor {
      display: flex;
      align-items: center;
      margin-bottom: 10px;
    }

    .top-contributors .contributor .username {
      font-weight: bold;
      margin-right: 10px;
    }

    .top-contributors .contributor .badge {
      font-size: 12px;
      padding: 4px 8px;
    }

    /* Top Questions Styles */
    .top-questions {
      background-color: #fff;
      border-radius: 5px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      padding: 20px;
    }

    .top-questions h4 {
      font-size: 18px;
      font-weight: bold;
      margin-bottom: 15px;
    }

    .top-questions ul {
      list-style-type: none;
      padding: 0;
    }

    .top-questions li {
      margin-bottom: 10px;
    }

    .top-questions li a {
      color: #333;
      text-decoration: none;
    }

    .top-questions li a:hover {
      color: #9c56e3;
    }
    .btn-custom {
        background-color: #9c56e3;
        border-color: #9c56e3; 
        color: white; 
    }   
  </style>

  <div class="container-fluid"  style="color: black;">
    <div class="row">
      <div class="col-md-8">
        <div class="question-card" id="question1">
            <h4>What are some effective exercises to build muscle mass?</h4>
            <p class="meta">1 days ago | 10 answers</p>
            <div class="d-flex justify-content-between align-items-center">
                <div class="d-flex align-items-center">
                    <img src="{% static 'profile-pic.jpg'%}" class="rounded-circle mr-2" width="30" height="30" alt="User Avatar">
                    <span class="username">Howard Hogan</span>
                </div>
                <div>
                    <button class="btn btn-custom btn-sm" onclick="toggleWriteAnswer('answer1')">Write</button>
                    <span class="pin-icon ml-2" onclick="togglePin('question1')">
                        <i id="pinIcon_question1" class="fas fa-thumbtack"></i> 
                    </span>
                    <span class="pin-icon ml-2" onclick="togglePin('question1')">
                      <i class="fas fa-times-circle"></i> 
                  </span>
                    
                </div>
            </div>
            <div class="write-answer" id="answer1" style="display: none;">
                <textarea class="form-control" rows="3" placeholder="Write your answer here"></textarea>
                <button class="btn btn-custom mt-2" onclick="submitAnswer('answer1')">Submit</button>
            </div>
            <div id="submittedAnswers1" class="submitted-answers"></div>
        </div>
        <div class="question-card" id="question2">
            <h4>How can I improve my flexibility for better performance in workouts?</h4>
            <p class="meta">2 days ago | 2 answers</p>
            <div class="d-flex justify-content-between align-items-center">
                  <div class="d-flex align-items-center">
                      <img src="{% static 'profile-pic.jpg'%}" class="rounded-circle mr-2" width="30" height="30" alt="User Avatar">
                      <span class="username">Johan Pritchel</span>
              </div>
              <div>
                  <button class="btn btn-custom btn-sm" onclick="toggleWriteAnswer('answer2')">Write</button>
                  <span class="pin-icon ml-2" onclick="togglePin('question2')">
                    <i id="pinIcon_question2" class="fas fa-thumbtack"></i> 
                </span>
                <span class="pin-icon ml-2" onclick="togglePin('question2')">
                    <i class="fas fa-times-circle"></i> 
                </span>
              </div>
            </div>
            <div class="write-answer" id="answer2" style="display: none;">
              <textarea class="form-control" rows="3" placeholder="Write your answer here"></textarea>
              <button class="btn btn-custom mt-2" onclick="submitAnswer('answer2')">Submit </button>
            </div>
            <div id="submittedAnswers2" class="submitted-answers"></div>
          </div>
          <div class="question-card" id="question3">
            <h4>What is the best way to lose belly fat?</h4>
            <p class="meta">1 days ago | 1 answers</p>
            <div class="d-flex justify-content-between align-items-center">
                  <div class="d-flex align-items-center">
                      <img src="{% static 'profile-pic.jpg'%}" class="rounded-circle mr-2" width="30" height="30" alt="User Avatar">
                      <span class="username">Mitchell Johnson</span>
              </div>
              <div>
                  <button class="btn btn-custom btn-sm" onclick="toggleWriteAnswer('answer3')">Write</button>
                  <span class="pin-icon ml-2" onclick="togglePin('question3')">
                      <i id="pinIcon_question3" class="fas fa-thumbtack"></i> 
                  </span>
                  <span class="pin-icon ml-2" onclick="togglePin('question3')">
                    <i class="fas fa-times-circle"></i> 
                </span>
              </div>
            </div>
            <div class="write-answer" id="answer3" style="display: none;">
              <textarea class="form-control" rows="3" placeholder="Write your answer here"></textarea>
              <button class="btn btn-custom mt-2" onclick="submitAnswer('answer3')">Submit </button>
            </div>
            <div id="submittedAnswers3" class="submitted-answers"></div>
          </div>
      </div>

      <div class="col-md-4">
        <div class="top-contributors">
          <h4>Top Contributors</h4>
            <div class="contributor">
                <img src="{% static 'profile-pic.jpg'%}" class="rounded-circle mr-2" width="30" height="30" alt="User Avatar">
                <span class="username">Johan Pritchel</span>
                <span class="badge badge-success">Active</span>
            </div>
          <div class="contributor">
                <img src="{% static 'profile-pic.jpg'%}" class="rounded-circle mr-2" width="30" height="30" alt="User Avatar">
                <span class="username">Howard Hogan</span>
                <span class="badge badge-danger">Inactive</span>
          </div>
          <div class="contributor">
                <img src="{% static 'profile-pic.jpg'%}" class="rounded-circle mr-2" width="30" height="30" alt="User Avatar">
                <span class="username">Mitchell Johnson</span>
                <span class="badge badge-success">Active</span>
          </div>
        </div>

        <div class="top-questions">
          <h4>Top Questions</h4>
            <ul>
                <li><a href="#">What are some effective exercises to build muscle mass?</a></li>
                <li><a href="#">How can I improve my flexibility for better performance in workouts?</a></li>
                <li><a href="#">What is the best way to lose belly fat?</a></li>
            </ul>
        </div>
      </div>
    </div>
  </div>

  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  <script>
    window.onload = function() {
        loadPinnedQuestions();
        loadPreviousAnswers();
        sortQuestions();
    };

    // Load previous answers on page load
    window.onload = function() {
        loadPreviousAnswers();
    };

    // Load previous answers from localStorage
    function loadPreviousAnswers() {
      for (let i = 1; i <= 3; i++) {
        let storedAnswers = localStorage.getItem("answers" + i);
        if (storedAnswers) {
          let submittedAnswersContainer = document.getElementById("submittedAnswers" + i);
          let answers = JSON.parse(storedAnswers);
          answers.forEach(function(answer) {
            let newAnswer = document.createElement("div");
            newAnswer.classList.add("submitted-answer");
            newAnswer.innerHTML = "<p><strong>Your Answer:</strong> " + answer + "</p>";
            submittedAnswersContainer.appendChild(newAnswer);
          });
        }
      }
    }
    function toggleWriteAnswer(answerId) {
      var answerDiv = document.getElementById(answerId);
      if (answerDiv.style.display === "none") {
        answerDiv.style.display = "block";
      } else {
        answerDiv.style.display = "none";
      }
    }
    // Function to submit an answer
    function submitAnswer(answerId) {
      var answerText = document.querySelector("#" + answerId + " textarea").value.trim();
      // Check if the answer is not empty
      if (answerText === '') {
        alert('Please write the answer.');
        return;
      }
      var submittedAnswersContainer = document.getElementById("submittedAnswers" + answerId.slice(-1));
      var newAnswerId = "answer" + answerId.slice(-1) + "_" + Date.now(); // Unique ID for each answer
      var newAnswer = document.createElement("div");
      newAnswer.setAttribute("id", newAnswerId)
      newAnswer.classList.add("submitted-answer");
      newAnswer.innerHTML = "<p><strong>Your Answer:</strong> " + answerText + "</p>";
      submittedAnswersContainer.appendChild(newAnswer);

      // Retrieve existing answers from localStorage
      var storedAnswers = localStorage.getItem("answers" + answerId.slice(-1));
      var answers = storedAnswers ? JSON.parse(storedAnswers) : [];
      answers.push(answerText);

      // Store the answers in localStorage
      localStorage.setItem("answers" + answerId.slice(-1), JSON.stringify(answers));
      
      // Clear the textarea after submitting the answer
      document.querySelector("#" + answerId + " textarea").value = "";
    }

    // Function to delete an answer
    function deleteAnswer(answerId) {
      var answerContainer = document.getElementById(answerId);
      answerContainer.parentNode.removeChild(answerContainer);

      // Remove the answer from localStorage
      var questionNumber = answerId.slice(-1);
      var storedAnswers = localStorage.getItem("answers" + questionNumber);
      if (storedAnswers) {
        var answers = JSON.parse(storedAnswers);
        answers.splice(answers.indexOf(answerId), 1);
        localStorage.setItem("answers" + questionNumber, JSON.stringify(answers));
      }
    }
  
    //toggle pin
    function togglePin(questionId) {
        var pinIcon = document.getElementById("pinIcon_" + questionId);
        pinIcon.classList.toggle("fa-thumbtack");
        pinIcon.classList.toggle("fa-thumbtack-o");
        var questionCard = document.getElementById("question" + questionId.slice(-1));
        questionCard.classList.toggle("pinned");
        var pinnedMsg = questionCard.querySelector(".pinned-msg");
        if (questionCard.classList.contains("pinned")) {
            if (!pinnedMsg) {
                pinnedMsg = document.createElement("small");
                pinnedMsg.classList.add("text-muted", "ml-2", "pinned-msg");
                pinnedMsg.textContent = "Pinned";
                questionCard.appendChild(pinnedMsg);
            }
            // Store the pinned state 
            localStorage.setItem(questionId, "pinned");
        } else {
            if (pinnedMsg) {
                questionCard.removeChild(pinnedMsg);
            }
            // unpinned  
            localStorage.removeItem(questionId);
        }
        sortQuestions();
    }

    // Function to sort the questions based on pinned status
    function sortQuestions() {
        var questionCards = document.querySelectorAll('.question-card');

        // array to store pinned and unpinned question 
        var pinnedQuestions = [];
        var unpinnedQuestions = [];

        // Separate pinned and unpinned question 
        questionCards.forEach(function(card) {
            if (card.classList.contains('pinned')) {
                pinnedQuestions.push(card);
            } else {
                unpinnedQuestions.push(card);
            }
        });

        var container = document.querySelector('.col-md-8');
        container.innerHTML = '';

        pinnedQuestions.forEach(function(card) {
            container.appendChild(card);
        });

        unpinnedQuestions.forEach(function(card) {
            container.appendChild(card);
        });
    }


  </script> 
{% endblock %}